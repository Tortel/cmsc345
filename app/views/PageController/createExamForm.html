#{extends 'main.html' /}
#{set title:'Create Exam' /}
*{ This is to verify the file type before upload }*
<script type="text/javascript"><!--
var ar_ext = ['avi', 'mpg', 'mpeg'];        // array with allowed extensions

function checkName(el, sbm) {
// - www.coursesweb.net
  // get the file name and split it to separe the extension
  var name = el.value;
  var ar_name = name.split('.');

  // for IE - separe dir paths (\) from name
  var ar_nm = ar_name[0].split('\\');
  for(var i=0; i<ar_nm.length; i++) var nm = ar_nm[i];

  // check the file extension
  var re = 0;
  for(var i=0; i<ar_ext.length; i++) {
    if(ar_ext[i] == ar_name[1]) {
      re = 1;
      break;
    }
  }

  // if re is 1, the extension is in the allowed list
  if(re==1) {
    // enable submit
    document.getElementById(sbm).disabled = false;
  }
  else {
    // delete the file name, disable Submit, Alert message
    el.value = '';
    document.getElementById(sbm).disabled = true;
    alert('".'+ ar_name[1]+ '" is not an file type allowed for upload');
  }
}
--></script>


<h3>Create Exam</h3>
#{ifErrors}
	<br>
	<b>Please fix the following errors:</b>
	
 	#{errors}
       <li>${error}</li>
   	#{/errors}
   	
	<br>
	<br>
#{/ifErrors}
#{form @PageController.createExam(), enctype:'multipart/form-data'}
	<table>
		<tr>
		<td>Patient:</td>
			<td>
				<select name="patientId" id="patientId">
	        	#{list items:patients, as:'patient'}
	        		#{if patientId != null && patientId == patient.id}
	        			<option value="${patient.id}" selected>${patient.getName()}</option>
	        		#{/if}
	        		#{else}
	        			<option value="${patient.id}">${patient.getName()}</option>
	        		#{/else}
	        	#{/list}
	        	</select>
			</td>
		</tr>
		<tr>
			<td>Ultrasound Video File:</td>
			<td>
				<input type="file" id="video" name="video" onchange="checkName(this, 'submit')" />
			</td>
		</tr>
		<tr>
			<td>Physician Comments:</td>
			<td>
				<textarea rows="3" cols="40" name="physicianComments" id="physicianComments">${physicianComments}</textarea>
			</td>
		</tr>
		<tr>
			<td>Patient Comments:</td>
			<td>
				<textarea rows="3" cols="40" name="patientComments" id="patientComments">${patientComments}</textarea>
			</td>
		</tr>
	<tr><td colspan="2" align="center">	<input type="submit" disabled="disabled" value="Create Exam" />	</td></tr>
	</table>
#{/form}